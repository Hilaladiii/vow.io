// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"    
}

model User{
  id String @id @default(uuid())
  email String @unique
  username String @unique
  password String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")  

  envelopes Envelope[]

  @@map("users")
}

model Document{
  id String @id @default(uuid())
  fileName String @map("file_name")
  fileKey String @map("file_key")
  createdAt DateTime @default(now()) @map("created_at")

  envelopeId String @unique @map("envelope_id")
  envelope Envelope @relation(fields: [envelopeId],references: [id])

  fields Field[]

  @@map("documents")
}

enum EnvelopeStatus{
  DRAFT
  SENT
  COMPLETED
}
model Envelope{
  id String @id @default(uuid())
  subject String
  status EnvelopeStatus
  createdAt DateTime @default(now()) @map("created_at")

  userId String @map("user_id")

  user User @relation(fields: [userId],references: [id])
  documents Document?
  signers Signer[]
  auditLogs AuditLog[] 

  @@map("envelopes")
}

enum SignerStatus{
  PENDING
  SIGNED
}
model Signer{
  id String @id @default(uuid())
  firstName String @map("first_name")
  lastName String @map("last_name")
  email String  
  status SignerStatus @default(PENDING)

  envelopeId String @map("envelope_id")
  envelope Envelope @relation(fields: [envelopeId],references: [id])
  fields Field[]

  @@map("signers")
}

enum FieldType{
  SIGNATURE
  DATE
  TEXT  
}
model Field{
  id String @id @default(uuid())
  value String?
  type FieldType  
  x Float 
  y Float
  pageNumber Int @map("page_number")

  signerId String @map("signer_id")
  signer Signer @relation(fields: [signerId],references: [id])

  documentId String @map("document_id")
  document Document @relation(fields: [documentId],references: [id])

  @@map("fields")
}

enum Action {
  SENT
  VIEW
  SIGNED
}

model AuditLog{
  id String @id @default(uuid())
  action Action
  user String
  ipAddress String @map("ip_address")
  datetime DateTime @default(now())

  envelopeId String @map("envelope_id")
  envelope Envelope @relation(fields: [envelopeId],references: [id])

  @@map("audit_logs")
}